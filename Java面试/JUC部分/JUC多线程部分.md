# JUC多线程部分

### Java乐观锁和悲观锁

**悲观锁**

悲观锁的代表就是synchronized和Lock锁

+ 核心思想是，线程只有占有了锁，才能去操作共享变量，每次只有一个线程占锁成功，获取锁失败的线程，都得停下来等待
+ 线程从运行到阻塞，再从阻塞到唤醒，设计线程的上下文切换，如果频繁地发生，会影响性能
+ 实际上，线程在获取synchronized和Lock锁时，如果锁已经被占用，都会做几次重试操作，减少阻塞的机会

**乐观锁**

乐观锁的代表就是AtomicInteger，使用CAS操作来保证原子性

+ 其核心思想是，无需加锁，每次只有一个线程能成功修改共享变量，其他失败的线程不需要停止，不断重试直至成功
+ 由于线程一直运行，不需要阻塞，因此不涉及线程上下文切换
+ 它需要多核CPU支持，且线程数应该和CPU核数相差不大



### ConcurrentHashMap



### ThreadLocal

**ThreadLocal的作用**

ThreadLocal可以实现【资源对象】的线程隔离，让每个线程各用各的【资源对象】，避免争用引发的线程安全问题

ThreadLocal同时实现了线程内的资源共享